# Motion Planning and Decision Making for Autonomous Vehicles

In this project, two of the main components of a traditional hierarchical planner will be implemented: The Behavior Planner and the Motion Planner. 

Both will work in unison to be able to:
* Avoid static objects (cars, bicycles and trucks) parked on the side of the road (but still invading the lane). The vehicle must avoid crashing with these vehicles by executing either a “nudge” or a “lane change” maneuver.
* Handle any type of intersection (3-way,  4-way intersections and roundabouts) by STOPPING in all of them (by default)
* Track the centerline on the traveling lane.

To accomplish this, these tasks will be implemented:

* Behavioral planning logic using Finite State Machines - FSM
* Static objects Collision checking.
* Path and Trajectory generation using Cubic Spirals
* Best trajectory selection though a cost function evaluation. This cost function will mainly perform a collision check and a proximity check to bring cost higher as we get closer or collide with objects but maintaining a bias to stay closer to the lane center line.

## Results
The simulation results on the CARLA platform show the ego vehicle can avoid the three vehicles parked on the lane and roadside, and turn smoothly on the two intersections. Behavioral planning makes the follow lane and change lane left/right states, then six trajectories are generated by cubic spirals method all the time. The trajectory of the motion with the lower cost is implemented for the ego vehicle.

![p1](https://github.com/junjiexu628/Self_Driving_C4_Motion_Plan_Decision_Make/blob/main/image_animation/P1.png)

![p3](https://github.com/junjiexu628/Self_Driving_C4_Motion_Plan_Decision_Make/blob/main/image_animation/P3.png)

![p2](https://github.com/junjiexu628/Self_Driving_C4_Motion_Plan_Decision_Make/blob/main/image_animation/P2.png)

![p4](https://github.com/junjiexu628/Self_Driving_C4_Motion_Plan_Decision_Make/blob/main/image_animation/P4.png)

![p5](https://github.com/junjiexu628/Self_Driving_C4_Motion_Plan_Decision_Make/blob/main/image_animation/P5.png)

![p6](https://github.com/junjiexu628/Self_Driving_C4_Motion_Plan_Decision_Make/blob/main/image_animation/P6.png)

![p7](https://github.com/junjiexu628/Self_Driving_C4_Motion_Plan_Decision_Make/blob/main/image_animation/P7.png)

## Summary
The traditional hierarchical planner has three layers: Route planning, behavior planning and motion planning. 
Route planning: For the unstructure enviornment, such as, the parking lot, the hybrid A* is suitable for route planning, and in terms of the structure environment, such as the highway traffic road, the trajectory plan is implemented.

Behavior planning: finite state machines is used to divide the behavior actions on the road into finite states, such as, follow lanes, stop, decel to stop, change lanes...For the global route, the behavior plan is to execute the local decision on the different route ranges according to the prediction, location and trajectory.

Motion planning: sigle step minimum jerk polynominal isn't implemented due to the discontinuty of the curvature and first derivative curvature. Cubic sprial is implemented for generating the trajectory. Rimpson rule is used for solve the (x,y)position of the ego vehicle due to the no-close form solution. The velocity profile is also generated according to the linear acceleration and compositional linear accelertion conditions. Collision check is also evaluated on the common 3 cricles enclosed the vehicle to calcuate the distance of each circles of ego vehicle and obstacle vehicle.

